<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8" />
  <title>Calendar: Table</title>
  <style>
    * {
      font-size: 1em;
      font-weight: 400;
      margin: 0;
      padding: 0;
    }
    :root {
      font-family: system-ui, sans-serif;
      font-size: calc(max(100%, min(2vw, 150%)));
      line-height: 1.5;
      color: white;
      background: color-mix(in srgb, crimson 4%, black);
    }
    body {
      margin: 1lh;
    }
    calendar-table {
      max-width: min-content;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;

      &:hover {
        box-shadow: 0 0 1px 1px blue;
      }

      table {
        border-spacing: 0;
        border-collapse: collapse;
      }

      caption {
        position: relative;

        button {
          position: absolute;
          top: 0;
          height: 100%;
          font-size: 1em;
          padding: 0;
          color: crimson;
          background: transparent;
          border: 0;
        }
        button[name="previous"] {
          left: 0;
        }
        button[name="next"] {
          right: 0;
        }
      }

      tr {
        border-bottom: 1px solid crimson;
      }
      tbody tr:last-child {
        border-bottom: none;
      }

      th {
        min-width: 4ch;
        color: crimson;
        font-weight: 400;
        font-style: italic;
      }

      td {
        padding: 0;
      }
    }
  </style>
  <script type="module">
    function isLeapYear(year) {
      return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);
    }

    function daysInMonth(year, month) {
      switch (month) {
        case 2:
          return isLeapYear(year) ? 29 : 28;
        case 4:
        case 6:
        case 9:
        case 11:
          return 30;
        default:
          return 31;
      }
    }

    function dayOfWeek(year, month, day) {
      if (month < 3) {
        month = month + 12;
        year = year - 1;
      }

      return (
        (day +
          Math.floor(2.6 * (month + 1)) +
          year +
          Math.floor(year / 4) -
          Math.floor(year / 100) +
          Math.floor(year / 400) +
          6) %
          7 || 7
      );
    }

    function* renderWeekRows(d, year, month) {
      let row = d.createElement("tr");

      const firstWeekday = dayOfWeek(year, month, 1);
      if (firstWeekday > 1) {
        const cell = d.createElement("td");
        cell.colSpan = firstWeekday - 1;
        row.appendChild(cell);
      }

      const totalDays = daysInMonth(year, month);

      for (let day = 1; day <= totalDays; day++) {
        const weekday = dayOfWeek(year, month, day);
        if (weekday === 1 && day !== 1) {
          if (row) yield row;
          row = d.createElement("tr");
        }

        const cell = d.createElement("td");
        cell.textContent = `${day}`;
        row.append(cell);
      }

      yield row;
    }

    class CalendarState {
      constructor(year, month) {
        this.year = year;
        this.month = month;
        Object.freeze(this);
      }

      previous() {
        const year = this.year - (this.month === 1 ? 1 : 0);
        const month = this.month === 1 ? 12 : this.month - 1;
        return new CalendarState(year, month);
      }

      next() {
        const year = this.year + (this.month === 12 ? 1 : 0);
        const month = this.month === 12 ? 1 : this.month + 1;
        return new CalendarState(year, month);
      }
    }

    const monthYearFormatter = new Intl.DateTimeFormat(undefined, {
      month: "long",
      year: "numeric",
    });

    class CalendarTable extends HTMLElement {
      connectedCallback() {
        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;

        const state = new CalendarState(year, month);
        this.state = state;

        const content = this.ownerDocument
          .querySelector("template#calendar-table")
          .content.cloneNode(true);

        this.append(content);

        this.update();

        this.addEventListener("click", this);
      }

      disconnectedCallback() {
        this.removeEventListener("click", this);
      }

      update() {
        const { year, month } = this.state;

        const captionText = monthYearFormatter.format(
          new Date(year, month - 1)
        );

        this.querySelector("h2").replaceChildren(captionText);

        this.querySelector("tbody").replaceChildren(
          ...renderWeekRows(this.ownerDocument, year, month)
        );
      }

      handleEvent(event) {
        const button = event.target.closest("button");
        if (button && event.type === "click") {
          if (button.name === "previous") {
            this.state = this.state.previous();
          } else if (button.name === "next") {
            this.state = this.state.next();
          }

          this.update();
        }
      }
    }
    customElements.define("calendar-table", CalendarTable);
  </script>
  <body>
    <template id="calendar-table">
      <table>
        <caption>
          <button type="button" name="previous">
            <svg
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m15 18-6-6 6-6" />
            </svg>
          </button>
          <h2>November 2025</h2>
          <button type="button" name="next">
            <svg
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m9 18 6-6-6-6" />
            </svg>
          </button>
        </caption>
        <thead>
          <tr>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
            <th>Sun</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="5"></td>
            <td>1</td>
            <td>2</td>
          </tr>
          <tr>
            <td>3</td>
            <td>4</td>
            <td>5</td>
            <td>6</td>
            <td>7</td>
            <td>8</td>
            <td>9</td>
          </tr>
          <tr>
            <td>10</td>
            <td>11</td>
            <td>12</td>
            <td>13</td>
            <td>14</td>
            <td>15</td>
            <td>16</td>
          </tr>
          <tr>
            <td>17</td>
            <td>18</td>
            <td>19</td>
            <td>20</td>
            <td>21</td>
            <td>22</td>
            <td>23</td>
          </tr>
          <tr>
            <td>24</td>
            <td>25</td>
            <td>26</td>
            <td>27</td>
            <td>28</td>
            <td>29</td>
            <td>30</td>
          </tr>
        </tbody>
      </table>
    </template>
    <calendar-table></calendar-table>
  </body>
</html>
