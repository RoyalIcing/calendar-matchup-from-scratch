<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8" />
  <title>Calendar: Table</title>
  <style>
    :root {
      font-family: system-ui, sans-serif;
      font-size: calc(max(100%, min(2vw, 150%)));
      line-height: 1.5;
      background: color-mix(in srgb, crimson 3%, white);
    }
    body {
      margin: 1lh;
    }
    calendar-table {
      max-width: min-content;
      margin: auto;
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;

      &:hover {
        box-shadow: 0 0 1px 1px blue;
      }

      table {
        border-spacing: 0;
        border-collapse: collapse;
      }

      caption {
        position: relative;

        button {
          position: absolute;
          height: 100%;
          font-size: 1em;
          padding: 0;
          color: crimson;
          background: transparent;
          border: 0;
        }
        button[name="previous"] {
          left: 0;
        }
        button[name="next"] {
          right: 0;
        }
      }

      tr {
        border-bottom: 1px solid crimson;
      }
      tbody tr:last-child {
        border-bottom: none;
      }

      th {
        padding: 0 0.5em;
        color: crimson;
        font-weight: 400;
        font-style: italic;
      }

      td {
        padding: 0;
      }
    }
  </style>
  <script type="module">
    function isLeapYear(year) {
      return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);
    }

    function daysInMonth(year, month) {
      if (month === 2) {
        return 28 + (isLeapYear(year) ? 1 : 0);
      }
      return [4, 6, 9, 11].includes(month) ? 30 : 31;
    }

    function dayOfWeek(year, month, day) {
      if (month < 3) {
        month = month + 12;
        year = year - 1;
      }

      const k = year % 100;
      const j = Math.floor(year / 100);

      const weekday =
        (day +
          Math.floor((13 * (month + 1)) / 5) +
          k +
          Math.floor(k / 4) +
          Math.floor(j / 4) +
          5 * j) %
        7;

      // Adjust the result to make Sunday 0 instead of Saturday 0
      return ((weekday + 5) % 7) + 1;
    }

    class CalendarTable extends HTMLElement {
      connectedCallback() {
        if (this.querySelector("table")) return;

        const today = new Date();
        const year = today.getFullYear();
        const month = today.getMonth() + 1;
        const todayDay = today.getDate();

        const d = this.ownerDocument;
        const tbody = d.createElement("tbody");
        let row = d.createElement("tr");

        const firstWeekday = dayOfWeek(year, month, 1);
        if (firstWeekday > 1) {
          const cell = d.createElement("td");
          cell.colSpan = firstWeekday - 1;
          row.appendChild(cell);
        }

        const totalDays = daysInMonth(today.getMonth() + 1);
        const todayWeekday = dayOfWeek(year, month, todayDay);

        for (let day = 1; day <= totalDays; day++) {
          const weekday = dayOfWeek(year, month, day);
          if (weekday === 1 && day !== 1) {
            if (row) tbody.appendChild(row);
            row = d.createElement("tr");
          }

          const cell = d.createElement("td");
          cell.textContent = `${day}`;
          row.append(cell);
        }

        const table = d.createElement("table");

        const fmt = new Intl.DateTimeFormat(undefined, {
          month: "long",
          year: "numeric",
        });
        const captionText = fmt.format(new Date(year, month - 1));

        const thead = d
          .querySelector("template#calendar-table-thead")
          .content.cloneNode(true);

        thead
          .querySelector("slot[name=monthYear]")
          .replaceChildren(captionText);

        table.append(thead, tbody);

        this.append(table);

        this.addEventListener("click", this);
      }

      disconnectedCallback() {
        this.removeEventListener("click", this);
      }

      handleEvent(event) {
        if (event.type === "click") {
          const button = event.target.closest("button");
          if (button) {
            if (button.name === "previous") {
              console.log("PREVIOUS");
            } else if (button.name === "next") {
              console.log("NEXT");
            }
          }
        }
      }
    }
    customElements.define("calendar-table", CalendarTable);
  </script>
  <body>
    <calendar-table>
      <table>
        <caption>
          <button type="button" name="previous">
            <svg
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m15 18-6-6 6-6" />
            </svg>
          </button>
          November 2025
          <button type="button" name="next">
            <svg
              width="1em"
              height="1em"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m9 18 6-6-6-6" />
            </svg>
          </button>
        </caption>
        <thead>
          <tr>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
            <th>Sun</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="5"></td>
            <td>1</td>
            <td>2</td>
          </tr>
          <tr>
            <td>3</td>
            <td>4</td>
            <td>5</td>
            <td>6</td>
            <td>7</td>
            <td>8</td>
            <td>9</td>
          </tr>
          <tr>
            <td>10</td>
            <td>11</td>
            <td>12</td>
            <td>13</td>
            <td>14</td>
            <td>15</td>
            <td>16</td>
          </tr>
          <tr>
            <td>17</td>
            <td>18</td>
            <td>19</td>
            <td>20</td>
            <td>21</td>
            <td>22</td>
            <td>23</td>
          </tr>
          <tr>
            <td>24</td>
            <td>25</td>
            <td>26</td>
            <td>27</td>
            <td>28</td>
            <td>29</td>
            <td>30</td>
          </tr>
          <tr>
            <td>31</td>
          </tr>
        </tbody>
      </table>
    </calendar-table>
    <template id="icons">
      <svg
        id="previous"
        width="1em"
        height="1em"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="m15 18-6-6 6-6" />
      </svg>
      <svg
        id="next"
        width="1em"
        height="1em"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="m9 18 6-6-6-6" />
      </svg>
    </template>
    <template id="calendar-table-thead">
      <caption>
        <button type="button" name="previous">
          <svg
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
        </button>
        <slot name="monthYear">November 2025</slot>
        <button type="button" name="next">
          <svg
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6" />
          </svg>
        </button>
      </caption>
      <thead>
        <tr>
          <th>Mon</th>
          <th>Tue</th>
          <th>Wed</th>
          <th>Thu</th>
          <th>Fri</th>
          <th>Sat</th>
          <th>Sun</th>
        </tr>
      </thead>
    </template>
    <calendar-table></calendar-table>
  </body>
</html>
