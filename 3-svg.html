<!DOCTYPE html>
<html lang="en">
  <meta charset="utf-8" />
  <title>Calendar: SVG</title>
  <style>
    * {
      font-size: 1em;
      font-weight: 400;
      margin: 0;
      padding: 0;
    }
    :root {
      font-family: system-ui, sans-serif;
      font-size: calc(max(100%, min(2vw, 150%)));
      line-height: 1.5;
      color: white;
      background: color-mix(in srgb, crimson 4%, black);
    }
    body {
      margin: 1lh;
    }
    calendar-svg {
      display: block;
      max-width: min-content;
      margin: auto;
      text-align: center;

      &:hover {
        box-shadow: 0 0 1px 1px blue;
      }

      header {
        position: relative;

        button {
          position: absolute;
          top: 0;
          height: 100%;
          font-size: 1em;
          padding: 0;
          color: crimson;
          background: transparent;
          border: 0;
        }
        button[name="previous"] {
          left: 0;
        }
        button[name="next"] {
          right: 0;
        }
      }

      svg {
        text,
        tspan {
          text-anchor: middle;
          dominant-baseline: middle;
        }
      }
    }
  </style>
  <script type="module">
    function isLeapYear(year) {
      return year % 4 === 0 && (year % 100 !== 0 || year % 400 === 0);
    }

    function daysInMonth(year, month) {
      switch (month) {
        case 2:
          return isLeapYear(year) ? 29 : 28;
        case 4:
        case 6:
        case 9:
        case 11:
          return 30;
        default:
          return 31;
      }
    }

    function dayOfWeek(year, month, day) {
      if (month < 3) {
        month = month + 12;
        year = year - 1;
      }

      return (day + Math.floor(2.6 * (month + 1)) + year + Math.floor(year / 4) - Math.floor(year / 100) + Math.floor(year / 400) + 6) % 7 || 7;
    }

    const svgURI = "http://www.w3.org/2000/svg";

    function* renderDays(d, year, month) {
      let weekGroup = d.createElementNS(svgURI, "g");

      const firstWeekday = dayOfWeek(year, month, 1);
      const totalDays = daysInMonth(year, month);

      for (let day = 1; day <= totalDays; day++) {
        const weekday = dayOfWeek(year, month, day);
        const weekOffset = 1 + Math.floor((day + firstWeekday - 2) / 7);

        if (weekday === 1 && day !== 1) {
          if (weekGroup) {
            const line = d.createElementNS(svgURI, "line");
            line.setAttribute("y1", `${weekOffset}lh`);
            line.setAttribute("y2", `${weekOffset}lh`);
            line.setAttribute("x2", "100%");
            line.setAttribute("fill", "none");
            line.setAttribute("stroke", "crimson");
            weekGroup.append(line);

            yield weekGroup;
          }
          weekGroup = d.createElementNS(svgURI, "g");
        }

        const text = d.createElementNS(svgURI, "text");
        text.setAttribute("x", `${2.5 + 4 * ((day + firstWeekday - 2) % 7)}ch`);
        text.setAttribute("y", `${weekOffset}.5lh`);
        text.setAttribute("dy", "2");
        text.textContent = `${day}`;
        weekGroup.append(text);
      }

      yield weekGroup;
    }

    class CalendarState {
      constructor(year, month) {
        this.year = year;
        this.month = month;
        Object.freeze(this);
      }

      previous() {
        return new CalendarState(
          this.year - (this.month === 1 ? 1 : 0),
          this.month === 1 ? 12 : this.month - 1
        );
      }

      next() {
        return new CalendarState(
          this.year + (this.month === 12 ? 1 : 0),
          this.month === 12 ? 1 : this.month + 1
        );
      }
    }

    const monthYearFormatter = new Intl.DateTimeFormat(undefined, {
      month: "long",
      year: "numeric",
    });

    class CalendarSVG extends HTMLElement {
      connectedCallback() {
        const today = new Date();
        const state = new CalendarState(
          today.getFullYear(),
          today.getMonth() + 1
        );
        this.state = state;

        const content = this.ownerDocument
          .querySelector("template#calendar-svg")
          .content.cloneNode(true);

        this.append(content);

        this.update();

        this.addEventListener("click", this);
      }

      disconnectedCallback() {
        this.removeEventListener("click", this);
      }

      update() {
        const { year, month } = this.state;

        const firstWeekday = dayOfWeek(year, month, 1);
        const totalDays = daysInMonth(year, month);
        const totalWeeks = Math.ceil((totalDays + firstWeekday - 1) / 7);
        this.querySelector("svg[data-calendar]").setAttribute(
          "height",
          `${totalWeeks + 1}lh`
        );

        const monthYear = monthYearFormatter.format(new Date(year, month - 1));
        this.querySelector("h2").replaceChildren(monthYear);

        this.querySelector("g[data-days]").replaceChildren(
          ...renderDays(this.ownerDocument, year, month)
        );
      }

      handleEvent(event) {
        const button = event.target.closest("button");
        if (button && event.type === "click") {
          if (button.name === "previous") {
            this.state = this.state.previous();
          } else if (button.name === "next") {
            this.state = this.state.next();
          }

          this.update();
        }
      }
    }
    customElements.define("calendar-svg", CalendarSVG);
  </script>
  <body>
    <template id="calendar-svg">
      <header>
        <button type="button" name="previous" aria-label="Previous month">
          <svg
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m15 18-6-6 6-6" />
          </svg>
        </button>
        <h2>November 2025</h2>
        <button type="button" name="next" aria-label="Next month">
          <svg
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m9 18 6-6-6-6" />
          </svg>
        </button>
      </header>
      <svg width="29ch" height="6lh" data-calendar>
        <title>Calendar for November 2025</title>
        <g fill="crimson">
          <text x="2.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Mon</tspan>
          </text>
          <text x="6.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Tue</tspan>
          </text>
          <text x="10.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Wed</tspan>
          </text>
          <text x="14.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Thu</tspan>
          </text>
          <text x="18.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Fri</tspan>
          </text>
          <text x="22.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Sat</tspan>
          </text>
          <text x="26.5ch" y="0.5lh" dy="2">
            <tspan font-style="italic">Sun</tspan>
          </text>
          <line y1="1lh" x2="100%" y2="1lh" fill="none" stroke="crimson" />
        </g>
        <g data-days fill="white">
          <g>
            <text x="3ch" y="1.5lh">1</text>
            <text x="8ch" y="1.5lh">2</text>
            <text x="13ch" y="1.5lh">3</text>
            <text x="18ch" y="1.5lh">4</text>
            <text x="23ch" y="1.5lh">5</text>
            <text x="28ch" y="1.5lh">6</text>
            <text x="33ch" y="1.5lh">7</text>
            <line y1="2lh" x2="100%" y2="2lh" fill="none" stroke="crimson" />
          </g>
          <g>
            <text x="3ch" y="2.5lh">8</text>
            <text x="8ch" y="2.5lh">9</text>
            <text x="13ch" y="2.5lh">10</text>
            <text x="18ch" y="2.5lh">11</text>
            <text x="23ch" y="2.5lh">12</text>
            <text x="28ch" y="2.5lh">13</text>
            <text x="33ch" y="2.5lh">14</text>
            <line y1="3lh" x2="100%" y2="3lh" fill="none" stroke="crimson" />
          </g>
          <g>
            <text x="3ch" y="3.5lh">15</text>
            <text x="8ch" y="3.5lh">16</text>
            <text x="13ch" y="3.5lh">17</text>
            <text x="18ch" y="3.5lh">18</text>
            <text x="23ch" y="3.5lh">19</text>
            <text x="28ch" y="3.5lh">20</text>
            <text x="33ch" y="3.5lh">21</text>
            <line y1="4lh" x2="100%" y2="4lh" fill="none" stroke="crimson" />
          </g>
          <g>
            <text x="3ch" y="4.5lh">22</text>
            <text x="8ch" y="4.5lh">23</text>
            <text x="13ch" y="4.5lh">24</text>
            <text x="18ch" y="4.5lh">25</text>
            <text x="23ch" y="4.5lh">26</text>
            <text x="28ch" y="4.5lh">27</text>
            <text x="33ch" y="4.5lh">28</text>
            <line y1="5lh" x2="100%" y2="5lh" fill="none" stroke="crimson" />
          </g>
          <g>
            <text x="3ch" y="5.5lh">29</text>
            <text x="8ch" y="5.5lh">30</text>
            <text x="13ch" y="5.5lh">31</text>
          </g>
        </g>
      </svg>
    </template>
    <calendar-svg></calendar-svg>
  </body>
</html>
